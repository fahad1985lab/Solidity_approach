<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>libraries.Mainlibrary</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="constantparameters.html" class="Module">constantparameters</a>

<a id="33" class="Keyword">module</a> <a id="40" href="libraries.Mainlibrary.html" class="Module">libraries.Mainlibrary</a> <a id="62" class="Keyword">where</a>

<a id="69" class="Keyword">open</a> <a id="74" class="Keyword">import</a> <a id="81" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="90" class="Keyword">open</a> <a id="95" class="Keyword">import</a> <a id="102" href="Data.List.html" class="Module">Data.List</a> <a id="112" class="Keyword">hiding</a> <a id="119" class="Symbol">(</a><a id="120" href="Data.List.Base.html#1954" class="Function Operator">_++_</a><a id="124" class="Symbol">)</a>
<a id="126" class="Keyword">open</a> <a id="131" class="Keyword">import</a> <a id="138" href="Agda.Builtin.Nat.html" class="Module">Agda.Builtin.Nat</a> <a id="155" class="Keyword">using</a> <a id="161" class="Symbol">(</a><a id="162" href="Agda.Builtin.Nat.html#426" class="Primitive Operator">_-_</a><a id="165" class="Symbol">;</a> <a id="167" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="170" class="Symbol">)</a>
<a id="172" class="Keyword">open</a> <a id="177" class="Keyword">import</a> <a id="184" href="Data.Unit.html" class="Module">Data.Unit</a>
<a id="194" class="Keyword">open</a> <a id="199" class="Keyword">import</a> <a id="206" href="Data.Bool.html" class="Module">Data.Bool</a>
<a id="216" class="Keyword">open</a> <a id="221" class="Keyword">import</a> <a id="228" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a>
<a id="243" class="Keyword">open</a> <a id="248" class="Keyword">import</a> <a id="255" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a>
<a id="269" class="Keyword">open</a> <a id="274" class="Keyword">import</a> <a id="281" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="292" class="Keyword">hiding</a> <a id="299" class="Symbol">(</a><a id="300" href="Data.Maybe.Base.html#2256" class="Function Operator">_&gt;&gt;=_</a><a id="305" class="Symbol">)</a>
<a id="307" class="Keyword">open</a> <a id="312" class="Keyword">import</a> <a id="319" href="Data.String.html" class="Module">Data.String</a> <a id="331" class="Keyword">hiding</a> <a id="338" class="Symbol">(</a><a id="339" href="Data.String.Base.html#2468" class="Function">length</a><a id="345" class="Symbol">;</a><a id="346" href="Data.String.Base.html#1605" class="Primitive">show</a><a id="350" class="Symbol">)</a>
<a id="352" class="Keyword">open</a> <a id="357" class="Keyword">import</a> <a id="364" href="Data.Nat.Show.html" class="Module">Data.Nat.Show</a>
<a id="378" class="Keyword">open</a> <a id="383" class="Keyword">import</a> <a id="390" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="406" class="Symbol">as</a> <a id="409" class="Module">Maybe</a> <a id="415" class="Keyword">using</a> <a id="421" class="Symbol">(</a><a id="422" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a><a id="427" class="Symbol">;</a> <a id="429" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="436" class="Symbol">;</a> <a id="438" href="Data.Maybe.Base.html#2379" class="Function Operator">_&lt;∣&gt;_</a><a id="443" class="Symbol">;</a> <a id="445" href="Data.Maybe.Base.html#2494" class="Function">when</a><a id="449" class="Symbol">)</a>
<a id="451" class="Keyword">open</a> <a id="456" class="Keyword">import</a> <a id="463" href="Data.Maybe.Effectful.html" class="Module">Data.Maybe.Effectful</a>
<a id="484" class="Keyword">open</a> <a id="489" class="Keyword">import</a> <a id="496" href="Data.Product.html" class="Module">Data.Product</a> <a id="509" class="Keyword">renaming</a> <a id="518" class="Symbol">(</a><a id="519" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,_</a> <a id="523" class="Symbol">to</a> <a id="526" class="InductiveConstructor Operator">_,,_</a> <a id="531" class="Symbol">)</a>
<a id="533" class="Keyword">open</a> <a id="538" class="Keyword">import</a> <a id="545" href="Agda.Builtin.String.html" class="Module">Agda.Builtin.String</a>


<a id="567" class="Comment">--our work</a>
<a id="578" class="Keyword">open</a> <a id="583" class="Keyword">import</a> <a id="590" href="basicDataStructure.html" class="Module">basicDataStructure</a>
<a id="609" class="Keyword">open</a> <a id="614" class="Keyword">import</a> <a id="621" href="libraries.natCompare.html" class="Module">libraries.natCompare</a>
<a id="642" class="Keyword">open</a> <a id="647" class="Keyword">import</a> <a id="654" href="Complex-Model.ccomand.ccommands-cresponse.html" class="Module">Complex-Model.ccomand.ccommands-cresponse</a>


<a id="698" class="Comment">--Definition of complex smart contract</a>
<a id="737" class="Keyword">record</a> <a id="Contract"></a><a id="744" href="libraries.Mainlibrary.html#744" class="Record">Contract</a> <a id="753" class="Symbol">:</a> <a id="755" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="759" class="Keyword">where</a>
  <a id="767" class="Keyword">constructor</a> <a id="contract"></a><a id="779" href="libraries.Mainlibrary.html#779" class="InductiveConstructor">contract</a>
  <a id="790" class="Keyword">field</a>
    <a id="Contract.amount"></a><a id="800" href="libraries.Mainlibrary.html#800" class="Field">amount</a>       <a id="813" class="Symbol">:</a> <a id="815" href="basicDataStructure.html#378" class="Function">Amount</a>
    <a id="Contract.fun"></a><a id="826" href="libraries.Mainlibrary.html#826" class="Field">fun</a>          <a id="839" class="Symbol">:</a> <a id="841" href="basicDataStructure.html#190" class="Function">FunctionName</a>
       <a id="861" class="Symbol">→</a> <a id="863" class="Symbol">(</a><a id="864" href="basicDataStructure.html#523" class="Datatype">Msg</a> <a id="868" class="Symbol">→</a> <a id="870" href="Complex-Model.ccomand.ccommands-cresponse.html#1546" class="Datatype">SmartContract</a> <a id="884" href="basicDataStructure.html#523" class="Datatype">Msg</a><a id="887" class="Symbol">)</a>  
    <a id="Contract.viewFunction"></a><a id="895" href="libraries.Mainlibrary.html#895" class="Field">viewFunction</a> <a id="908" class="Symbol">:</a> <a id="910" href="basicDataStructure.html#190" class="Function">FunctionName</a>
       <a id="930" class="Symbol">→</a> <a id="932" href="basicDataStructure.html#523" class="Datatype">Msg</a> <a id="936" class="Symbol">→</a> <a id="938" href="basicDataStructure.html#1431" class="Datatype">MsgOrError</a>
    <a id="Contract.viewFunctionCost"></a><a id="953" href="libraries.Mainlibrary.html#953" class="Field">viewFunctionCost</a> <a id="970" class="Symbol">:</a> <a id="972" href="basicDataStructure.html#190" class="Function">FunctionName</a>
       <a id="992" class="Symbol">→</a> <a id="994" href="basicDataStructure.html#523" class="Datatype">Msg</a> <a id="998" class="Symbol">→</a> <a id="1000" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
<a id="1002" class="Keyword">open</a> <a id="1007" href="libraries.Mainlibrary.html#744" class="Module">Contract</a> <a id="1016" class="Keyword">public</a>




<a id="1027" class="Comment">--ledger</a>
<a id="Ledger"></a><a id="1036" href="libraries.Mainlibrary.html#1036" class="Function">Ledger</a> <a id="1043" class="Symbol">:</a> <a id="1045" href="Agda.Primitive.html#388" class="Primitive">Set</a>
<a id="1049" href="libraries.Mainlibrary.html#1036" class="Function">Ledger</a> <a id="1056" class="Symbol">=</a> <a id="1058" href="basicDataStructure.html#405" class="Function">Address</a>  <a id="1067" class="Symbol">→</a> <a id="1069" href="libraries.Mainlibrary.html#744" class="Record">Contract</a>



<a id="1081" class="Comment">-- the execution stack element</a>
<a id="1112" class="Keyword">record</a> <a id="ExecStackEl"></a><a id="1119" href="libraries.Mainlibrary.html#1119" class="Record">ExecStackEl</a> <a id="1131" class="Symbol">:</a> <a id="1133" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1137" class="Keyword">where</a>
  <a id="1145" class="Keyword">constructor</a> <a id="execStackEl"></a><a id="1157" href="libraries.Mainlibrary.html#1157" class="InductiveConstructor">execStackEl</a>
  <a id="1171" class="Keyword">field</a>
    <a id="ExecStackEl.lastCallAddress"></a><a id="1181" href="libraries.Mainlibrary.html#1181" class="Field">lastCallAddress</a> <a id="1197" class="Symbol">:</a> <a id="1199" href="basicDataStructure.html#405" class="Function">Address</a>   <a id="1209" class="Comment">-- the address which made the call to the current function call</a>
    <a id="ExecStackEl.calledAddress"></a><a id="1277" href="libraries.Mainlibrary.html#1277" class="Field">calledAddress</a>   <a id="1293" class="Symbol">:</a> <a id="1295" href="basicDataStructure.html#405" class="Function">Address</a>   <a id="1305" class="Comment">-- is the address to which the last current function call was made from lastCallAddr</a>
    <a id="ExecStackEl.continuation"></a><a id="1394" href="libraries.Mainlibrary.html#1394" class="Field">continuation</a>    <a id="1410" class="Symbol">:</a> <a id="1412" class="Symbol">(</a><a id="1413" href="basicDataStructure.html#523" class="Datatype">Msg</a> <a id="1417" class="Symbol">→</a> <a id="1419" href="Complex-Model.ccomand.ccommands-cresponse.html#1546" class="Datatype">SmartContract</a> <a id="1433" href="basicDataStructure.html#523" class="Datatype">Msg</a><a id="1436" class="Symbol">)</a> <a id="1438" class="Comment">-- continuation how to proceed once a result is returned, which depends on that result which is an element of Msg</a>
    <a id="ExecStackEl.costCont"></a><a id="1556" href="libraries.Mainlibrary.html#1556" class="Field">costCont</a>  <a id="1566" class="Symbol">:</a> <a id="1568" href="basicDataStructure.html#523" class="Datatype">Msg</a> <a id="1572" class="Symbol">→</a> <a id="1574" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="1576" class="Comment">-- Cost for continuation depending on the msg returned when the current call is finished</a>
                          <a id="1691" class="Comment">-- The following two elements are only for debugging purposes so that in case of an error</a>
    <a id="ExecStackEl.funcNameexecStackEl"></a><a id="1785" href="libraries.Mainlibrary.html#1785" class="Field">funcNameexecStackEl</a>  <a id="1806" class="Symbol">:</a> <a id="1808" href="basicDataStructure.html#190" class="Function">FunctionName</a>     <a id="1825" class="Comment">--functionanme is the name of the function which was called</a>

    <a id="ExecStackEl.msgexecStackEl"></a><a id="1890" href="libraries.Mainlibrary.html#1890" class="Field">msgexecStackEl</a>       <a id="1911" class="Symbol">:</a> <a id="1913" href="basicDataStructure.html#523" class="Datatype">Msg</a> <a id="1917" class="Comment">--msg is the arguments with which this funciton was called.</a>
<a id="1977" class="Keyword">open</a> <a id="1982" href="libraries.Mainlibrary.html#1119" class="Module">ExecStackEl</a> <a id="1994" class="Keyword">public</a>



<a id="2004" class="Comment">-- execution stack function</a>
<a id="ExecutionStack"></a><a id="2032" href="libraries.Mainlibrary.html#2032" class="Function">ExecutionStack</a> <a id="2047" class="Symbol">:</a> <a id="2049" href="Agda.Primitive.html#388" class="Primitive">Set</a>
<a id="2053" href="libraries.Mainlibrary.html#2032" class="Function">ExecutionStack</a> <a id="2068" class="Symbol">=</a> <a id="2070" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2075" href="libraries.Mainlibrary.html#1119" class="Record">ExecStackEl</a>





<a id="2092" class="Comment">-- the state execution function</a>
<a id="2124" class="Keyword">record</a> <a id="StateExecFun"></a><a id="2131" href="libraries.Mainlibrary.html#2131" class="Record">StateExecFun</a> <a id="2144" class="Symbol">:</a> <a id="2146" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="2150" class="Keyword">where</a>
  <a id="2158" class="Keyword">constructor</a> <a id="stateEF"></a><a id="2170" href="libraries.Mainlibrary.html#2170" class="InductiveConstructor">stateEF</a>
  <a id="2180" class="Keyword">field</a>
    <a id="StateExecFun.ledger"></a><a id="2190" href="libraries.Mainlibrary.html#2190" class="Field">ledger</a> <a id="2197" class="Symbol">:</a> <a id="2199" href="libraries.Mainlibrary.html#1036" class="Function">Ledger</a>
    <a id="StateExecFun.executionStack"></a><a id="2210" href="libraries.Mainlibrary.html#2210" class="Field">executionStack</a> <a id="2225" class="Symbol">:</a> <a id="2227" href="libraries.Mainlibrary.html#2032" class="Function">ExecutionStack</a>
    <a id="StateExecFun.initialAddr"></a><a id="2246" href="libraries.Mainlibrary.html#2246" class="Field">initialAddr</a> <a id="2258" class="Symbol">:</a>  <a id="2261" href="basicDataStructure.html#405" class="Function">Address</a> <a id="2269" class="Comment">-- the address which initiated everything</a>
    <a id="StateExecFun.lastCallAddr"></a><a id="2315" href="libraries.Mainlibrary.html#2315" class="Field">lastCallAddr</a>    <a id="2331" class="Symbol">:</a> <a id="2333" href="basicDataStructure.html#405" class="Function">Address</a> <a id="2341" class="Comment">-- the address which made the call to the current function call</a>
    <a id="StateExecFun.calledAddr"></a><a id="2409" href="libraries.Mainlibrary.html#2409" class="Field">calledAddr</a> <a id="2420" class="Symbol">:</a> <a id="2422" href="basicDataStructure.html#405" class="Function">Address</a>   <a id="2432" class="Comment">-- is the address to which the last current fucntion call was made from lastCallAddr</a>
    <a id="StateExecFun.nextstep"></a><a id="2521" href="libraries.Mainlibrary.html#2521" class="Field">nextstep</a>  <a id="2531" class="Symbol">:</a> <a id="2533" href="Complex-Model.ccomand.ccommands-cresponse.html#1546" class="Datatype">SmartContract</a> <a id="2547" href="basicDataStructure.html#523" class="Datatype">Msg</a>   <a id="2553" class="Comment">-- next step in the program to be executed when</a>
    <a id="StateExecFun.gasLeft"></a><a id="2605" href="libraries.Mainlibrary.html#2605" class="Field">gasLeft</a>   <a id="2615" class="Symbol">:</a> <a id="2617" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>  <a id="2620" class="Comment">-- how much we have left in the next execution step</a>

<a id="2673" class="Comment">--these info regarding debug info :</a>

    <a id="StateExecFun.funNameevalState"></a><a id="2714" href="libraries.Mainlibrary.html#2714" class="Field">funNameevalState</a> <a id="2731" class="Symbol">:</a> <a id="2733" href="basicDataStructure.html#190" class="Function">FunctionName</a>
    <a id="StateExecFun.msgevalState"></a><a id="2750" href="libraries.Mainlibrary.html#2750" class="Field">msgevalState</a> <a id="2763" class="Symbol">:</a> <a id="2765" href="basicDataStructure.html#523" class="Datatype">Msg</a>
<a id="2769" class="Keyword">open</a> <a id="2774" href="libraries.Mainlibrary.html#2131" class="Module">StateExecFun</a> <a id="2787" class="Keyword">public</a>

</pre></body></html>